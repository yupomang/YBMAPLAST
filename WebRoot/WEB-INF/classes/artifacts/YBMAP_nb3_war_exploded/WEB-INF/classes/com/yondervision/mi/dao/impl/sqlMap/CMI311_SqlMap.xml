<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="CMI311">
  <resultMap class="com.yondervision.mi.dto.Mi311" id="CMi311Result">
    <result column="CONDITION_RADIO_ID" jdbcType="VARCHAR" property="conditionRadioId" />
    <result column="CONSULT_ITEM_ID" jdbcType="VARCHAR" property="consultItemId" />
    <result column="CONDITION_ID" jdbcType="VARCHAR" property="conditionId" />
    <result column="VALIDFLAG" jdbcType="CHAR" property="validflag" />
    <result column="DATECREATED" jdbcType="CHAR" property="datecreated" />
  </resultMap>
  
  <resultMap class="com.yondervision.mi.dto.Mi311" id="CMi311ResultRadioId">
    <result column="CONDITION_RADIO_ID" jdbcType="VARCHAR" property="conditionRadioId" />
  </resultMap>
  
  <select id="selectAllByListConditionId" parameterClass="java.util.Map" resultMap="CMi311Result">
    select g.CONDITION_RADIO_ID, g.CONSULT_ITEM_ID, g.CONDITION_ID, g.VALIDFLAG, g.DATECREATED 
	from
		(
		select d.CONDITION_RADIO_ID as CONDITION_RADIO_ID,count(d.CONDITION_RADIO_ID) as num 
		from mi311 d
		where d.CONDITION_ID in (<iterate property="listConditionId" conjunction=",">#listConditionId[]#</iterate>) 
		and d.CONDITION_RADIO_ID in 
			(select a.CONDITION_RADIO_ID as CONDITION_RADIO_ID
			from MI311 a,MI311 b 
			where a.CONDITION_RADIO_ID=b.CONDITION_RADIO_ID 
			and a.CONDITION_ID=b.CONDITION_ID and a.CONDITION_ID in (<iterate property="listConditionId1" conjunction=",">#listConditionId1[]#</iterate>) 
			group by a.CONDITION_RADIO_ID) 
		group by d.CONDITION_RADIO_ID 
		) e,
		(
		select d.CONDITION_RADIO_ID as CONDITION_RADIO_ID,count(d.CONDITION_RADIO_ID) as num
		from mi311 d
		where d.CONDITION_RADIO_ID in     
			(select a.CONDITION_RADIO_ID as CONDITION_RADIO_ID
			from MI311 a,MI311 b 
			where a.CONDITION_RADIO_ID=b.CONDITION_RADIO_ID 
			and a.CONDITION_ID=b.CONDITION_ID and a.CONDITION_ID in (<iterate property="listConditionId2" conjunction=",">#listConditionId2[]#</iterate>)
			group by a.CONDITION_RADIO_ID)
		group by d.CONDITION_RADIO_ID 
		) f,
		mi311 g
	where e.CONDITION_RADIO_ID =f.CONDITION_RADIO_ID 
		and e.CONDITION_RADIO_ID =g.CONDITION_RADIO_ID 
		and e.num=f.num
  </select>
  
  <select id="selectByListConditionId" parameterClass="java.util.Map" resultMap="CMi311ResultRadioId">
   	select e.CONDITION_RADIO_ID 
	from
		(
		select d.CONDITION_RADIO_ID as CONDITION_RADIO_ID,count(d.CONDITION_RADIO_ID) as num 
		from mi311 d
		where d.CONDITION_ID in (<iterate property="listConditionId" conjunction=",">#listConditionId[]#</iterate>) 
		and d.CONDITION_RADIO_ID in 
			(select a.CONDITION_RADIO_ID as CONDITION_RADIO_ID
			from MI311 a,MI311 b 
			where a.CONDITION_RADIO_ID=b.CONDITION_RADIO_ID 
			and a.CONDITION_ID=b.CONDITION_ID and a.CONDITION_ID in (<iterate property="listConditionId1" conjunction=",">#listConditionId1[]#</iterate>) 
			group by a.CONDITION_RADIO_ID having count(a.CONDITION_RADIO_ID) = #size#) 
		group by d.CONDITION_RADIO_ID
		) e,
		(
		select d.CONDITION_RADIO_ID as CONDITION_RADIO_ID,count(d.CONDITION_RADIO_ID) as num
		from mi311 d
		where d.CONDITION_RADIO_ID in     
			(select a.CONDITION_RADIO_ID as CONDITION_RADIO_ID
			from MI311 a,MI311 b 
			where a.CONDITION_RADIO_ID=b.CONDITION_RADIO_ID 
			and a.CONDITION_ID=b.CONDITION_ID and a.CONDITION_ID in (<iterate property="listConditionId2" conjunction=",">#listConditionId2[]#</iterate>)
			group by a.CONDITION_RADIO_ID having count(a.CONDITION_RADIO_ID) = #size#)
		group by d.CONDITION_RADIO_ID 
		) f
	where e.CONDITION_RADIO_ID =f.CONDITION_RADIO_ID 
		and e.num=f.num
  </select>
</sqlMap>