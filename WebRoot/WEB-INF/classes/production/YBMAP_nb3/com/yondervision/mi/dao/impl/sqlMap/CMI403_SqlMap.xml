<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="CMI403">
	<resultMap class="java.util.HashMap" id="webapi40301">
		<result column="itemid" jdbcType="VARCHAR" property="itemid" />
		<result column="itemval" jdbcType="VARCHAR" property="itemval" />
		<result column="cnt" jdbcType="VARCHAR" property="cnt" />
		<result column="succ" jdbcType="VARCHAR" property="succ" />
		<result column="fail" jdbcType="VARCHAR" property="fail" />
  	</resultMap>
  	<resultMap class="java.util.HashMap" id="webapi40302">
		<result column="cnt" jdbcType="VARCHAR" property="cnt" />
  	</resultMap>
	<select id="webapi403" resultMap="webapi40302" parameterClass="java.util.HashMap" > 	
		select count(*) cnt from mi403 
		where pus_message_type=#pushType:VARCHAR# 
			and status=#status:VARCHAR# 
			and validflag=1 
			and centerid=#centerId:VARCHAR#
			and substr(datemodified, 1, 10)&gt;=#startdate:VARCHAR# 
			and substr(datemodified, 1, 10)&lt;=#enddate:VARCHAR#
			and pid=#pid:VARCHAR#
  	</select>
  	<select id="webapi40301" resultMap="webapi40301" parameterClass="java.util.HashMap" > 	
		select t4.itemid, t4.itemval,t3.cnt,t3.succ,t3.fail from
			(select case when t1.theme is null then t2.theme else t1.theme end as theme,
				case when t1.succ is null then '0' else t1.succ end as succ,
				case when t2.fail is null then '0' else t2.fail end as fail,
			 	t1.succ+t2.fail as cnt 
			 from
				(select theme, count(*) succ 
				from mi403 
				where status=1 and validflag=1 
                    and centerid=#centerId:VARCHAR#
		    		and substr(datecreated, 1, 10)&gt;=#startdate:VARCHAR#
		   			and substr(datecreated, 1, 10)&lt;=#enddate:VARCHAR#
		    		and pid=#pid:VARCHAR#
		    		and pus_message_type='03' 
				group by theme) t1
			full join
				(select theme, count(*) fail 
				from mi403 
                where status=2 and validflag=1 
                    and centerid=#centerId:VARCHAR#
		    		and substr(datecreated, 1, 10)&gt;=#startdate:VARCHAR#
		    		and substr(datecreated, 1, 10)&lt;=#enddate:VARCHAR#
		    		and pid=#pid:VARCHAR#
		    		and pus_message_type='03' 
				group by theme) t2
			on t1.theme=t2.theme) t3
		join mi007 t4 on t3.theme = t4.itemid and t4.updicid in (
			select dicid from mi007 where itemid='message_topic_type')
  	</select>
  
</sqlMap>